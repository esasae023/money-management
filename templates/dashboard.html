{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üìä Dashboard: {{ folder.name }}</h2>
    <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            üóìÔ∏è Bulan: {{ selected_month }}
        </button>
        <ul class="dropdown-menu">
            {% for sheet in sheet_list %}
            <li><a class="dropdown-item" href="{{ url_for('dashboard', folder_id=folder.id, month=sheet) }}">{{ sheet }}</a></li>
            {% endfor %}
        </ul>
        <a href="{{ url_for('folder_settings', folder_id=folder.id) }}" class="btn btn-secondary ms-2">‚öôÔ∏è Config</a>
    </div>
</div>

{% if error_msg %}
<div class="alert alert-danger">{{ error_msg }}</div>
{% endif %}

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-success h-100 hover-effect">
            <div class="card-body">
                <h5 class="card-title">Pemasukan</h5>
                <h2 class="fw-bold">Rp {{ summary.income }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-danger h-100 hover-effect">
            <div class="card-body">
                <h5 class="card-title">Pengeluaran</h5>
                <h2 class="fw-bold">Rp {{ summary.expense }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-primary h-100 hover-effect">
            <div class="card-body">
                <h5 class="card-title">Sisa Saldo</h5>
                <h2 class="fw-bold">Rp {{ summary.balance }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-header fw-bold">üìà Trend Pemasukan vs Pengeluaran</div>
    <div class="card-body">
        <canvas id="trendChart" style="max-height: 400px;"></canvas>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm border-success">
            <div class="card-header bg-success text-white fw-bold">Kategori Pemasukan</div>
            <div class="card-body">
                <canvas id="incomePieChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm border-danger">
            <div class="card-header bg-danger text-white fw-bold">Kategori Pengeluaran</div>
            <div class="card-body">
                <canvas id="expensePieChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. Line Chart (Trend)
    const ctxTrend = document.getElementById('trendChart').getContext('2d');
    new Chart(ctxTrend, {
        type: 'line',
        data: {
            labels: {{ chart_trend.labels | tojson }},
            datasets: [
                {
                    label: 'Pemasukan',
                    data: {{ chart_trend.income | tojson }},
                    borderColor: '#198754', // Hijau
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'Pengeluaran',
                    data: {{ chart_trend.expense | tojson }},
                    borderColor: '#dc3545', // Merah
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.3,
                    fill: true
                }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // 2. Pie Chart Pemasukan (Kiri)
    const ctxInc = document.getElementById('incomePieChart').getContext('2d');
    new Chart(ctxInc, {
        type: 'doughnut',
        data: {
            labels: {{ pie_income.labels | tojson }},
            datasets: [{
                data: {{ pie_income.data | tojson }},
                backgroundColor: ['#20c997', '#198754', '#0f5132', '#75b798', '#a3cfbb']
            }]
        }
    });

    // 3. Pie Chart Pengeluaran (Kanan)
    const ctxExp = document.getElementById('expensePieChart').getContext('2d');
    new Chart(ctxExp, {
        type: 'doughnut',
        data: {
            labels: {{ pie_expense.labels | tojson }},
            datasets: [{
                data: {{ pie_expense.data | tojson }},
                backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#e63757', '#fa5252']
            }]
        }
    });
</script>
{% endblock %}