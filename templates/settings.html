{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">‚öôÔ∏è Tambah Konfigurasi / Folder Baru</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Label Folder (Tahun)</label>
                        <input type="text" class="form-control" name="year_label" placeholder="Contoh: Tahun 2025" required>
                        <div class="form-text">Nama folder yang akan muncul di dropdown dashboard.</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Link Google Spreadsheet</label>
                        <input type="url" class="form-control" name="sheet_url" placeholder="https://docs.google.com/spreadsheets/d/..." required>
                        <div class="form-text">Pastikan link sheet bisa diakses oleh Service Account Email (Share sheet ke email service account).</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Google Service Account Credentials (JSON)</label>
                        <textarea class="form-control" name="google_creds" rows="8" placeholder='{"type": "service_account", "project_id": "...", ...}' required></textarea>
                        <div class="form-text text-danger">Buka file JSON credentials Anda di Notepad, copy SEMUA isinya, lalu paste di sini. Data ini akan dienkripsi di database.</div>
                    </div>

                    <hr>
                    <h6>Mapping Kolom (Opsional - Sesuai format Anda)</h6>
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <label class="form-label text-muted small">Nama Kolom Tanggal</label>
                            <input type="text" class="form-control form-control-sm" name="col_date" value="Timestamp">
                        </div>
                        <div class="col-md-4 mb-2">
                            <label class="form-label text-muted small">Nama Kolom Pemasukan</label>
                            <input type="text" class="form-control form-control-sm" name="col_in" value="Nominal Pemasukan">
                        </div>
                        <div class="col-md-4 mb-2">
                            <label class="form-label text-muted small">Nama Kolom Pengeluaran</label>
                            <input type="text" class="form-control form-control-sm" name="col_out" value="Nominal Pengeluaran">
                        </div>
                    </div>

                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-success">Simpan Konfigurasi</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">Daftar Konfigurasi Tersimpan</div>
            <div class="card-body">
                <ul class="list-group">
                    {% for conf in current_user.spreadsheets %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>üìÅ {{ conf.year_label }}</span>
                            <small class="text-muted text-truncate truncate-200">{{ conf.sheet_url }}</small>
                        </li>
                    {% else %}
                        <li class="list-group-item text-center text-muted">Belum ada konfigurasi sheet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}